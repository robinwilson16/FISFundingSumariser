CREATE VIEW FIS_Employers
AS
	SELECT
		EmployerEDRS = CASE WHEN ISNUMERIC ( ORG.EDRSRef ) = 1 THEN CAST ( ORG.EDRSRef AS INT ) ELSE NULL END,
		EmployerName = MIN ( ORG.Name )
	FROM besql03.ProSolution.dbo.Organisation ORG
	WHERE
		ORG.Active = 1
		AND CASE WHEN ISNUMERIC ( ORG.EDRSRef ) = 1 THEN CAST ( ORG.EDRSRef AS INT ) ELSE NULL END IS NOT NULL
		AND LEN ( LTRIM ( RTRIM ( ORG.EDRSRef ) ) ) = 9
	GROUP BY
		CASE WHEN ISNUMERIC ( ORG.EDRSRef ) = 1 THEN CAST ( ORG.EDRSRef AS INT ) ELSE NULL END